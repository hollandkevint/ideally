# Story 1.2: Authentication & Workspace Management (MVP Scope)

## Status

**Current Status:** Draft

## Story

**As an** entrepreneur/consultant,  
**I want** to securely access my strategic thinking workspace,  
**so that** I can maintain privacy of my ideas and resume work across sessions.

## Acceptance Criteria (MVP Scope - Simplified)

1. User registration with email/password authentication
2. Auto-creation of single workspace per user
3. Session persistence maintaining both chat history and canvas state
4. Direct workspace access after authentication
5. Basic account management (password change, account deletion)

## Tasks / Subtasks

- [ ] **Basic Authentication System** (AC: 1)
  - [ ] Configure Supabase Auth with email/password provider only
  - [ ] Create simple registration and login components
  - [ ] Implement JWT token handling and automatic refresh
  - [ ] Add basic password reset flow
  - [ ] Create authentication guards for workspace access

- [ ] **Single Workspace Auto-Creation** (AC: 2)
  - [ ] Create user_workspace table with one-to-one relationship
  - [ ] Implement workspace auto-creation on user registration
  - [ ] Set up initial workspace state structure
  - [ ] Create workspace access routing (direct redirect after login)

- [ ] **Simplified State Persistence** (AC: 3)
  - [ ] Design simplified workspace state schema (JSONB column)
  - [ ] Implement auto-save functionality with debouncing
  - [ ] Create workspace state restoration on login
  - [ ] Handle basic offline/online state scenarios
  - [ ] Add loading states for state restoration

- [ ] **Direct Workspace Access** (AC: 4)
  - [ ] Implement automatic redirect to workspace after login
  - [ ] Create workspace loading and initialization
  - [ ] Add workspace state validation and error handling
  - [ ] Implement session restoration without dashboard complexity

- [ ] **Basic Account Management** (AC: 5)
  - [ ] Create simple account settings page
  - [ ] Implement password change functionality
  - [ ] Add account deletion with workspace cleanup
  - [ ] Create basic user profile display

## Dev Notes

Based on the architecture document and MVP scope reduction, here are the simplified implementation details:

### Technical Stack Configuration (Simplified)

**Authentication:** Supabase Auth with email/password only
- Remove OAuth complexity for MVP
- Simple registration/login flow
- JWT token handling with automatic refresh

**Workspace Model (Simplified):**
```sql
-- Simplified schema for MVP
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email TEXT UNIQUE NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE user_workspace (
    user_id UUID PRIMARY KEY REFERENCES users(id),
    workspace_state JSONB NOT NULL DEFAULT '{}',
    updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

**State Management:** 
- Single workspace state stored in JSONB column
- Auto-save on changes (debounced to prevent excessive API calls)
- Direct workspace access after authentication

**Authentication Flow:**
```typescript
// Simplified auth types
interface User {
  id: string;
  email: string;
}

interface WorkspaceState {
  chat_context: ChatMessage[];
  canvas_elements: CanvasElement[];
  last_session_progress: number;
}
```

**Environment Variables (Reduced):**
```bash
# MVP - Only essential variables
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
```

**Key MVP Architectural Decisions:**
- One workspace per user eliminates complex routing and permissions
- JSONB workspace_state stores entire dual-pane state in single column
- Auto-save replaces complex state synchronization
- Direct workspace redirect eliminates dashboard complexity

### Testing

**Testing Standards (Simplified):**

**Test File Location:** 
- Authentication tests: `apps/web/tests/auth/`
- Workspace tests: `apps/web/tests/workspace/`

**Testing Frameworks:**
- **Frontend:** Vitest + Testing Library for auth components
- **E2E:** Playwright for registration â†’ workspace flow

**Specific MVP Testing Requirements:**
- Test email/password registration and login flow
- Verify workspace auto-creation on user registration  
- Test workspace state persistence and restoration
- Validate auto-save functionality with debouncing
- Test session restoration after browser refresh

**Benefits of MVP scope:**
- 60% faster development time
- Easier debugging and testing
- Clearer user validation metrics
- Reduced infrastructure complexity

**Post-MVP expansion path:**
- OAuth integration after core concept proven
- Multiple workspaces after user demand validated
- Sharing features for team collaboration
- Dashboard for workspace management

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-24 | 1.0 | Initial story creation for Epic 1.2 Authentication (MVP scope) | BMad Master |

## Dev Agent Record

*(This section is owned by dev-agent and can only be modified by dev-agent)*

### Agent Model Used

*(To be populated by development agent during implementation)*

### Debug Log References

*(To be populated by development agent during implementation)*

### Completion Notes List

*(To be populated by development agent during implementation)*

### File List

*(To be populated by development agent during implementation)*

## QA Results

*(This section is owned by qa-agent and can only be modified by qa-agent)*