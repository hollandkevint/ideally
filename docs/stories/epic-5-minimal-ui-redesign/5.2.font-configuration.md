# Story 5.2: Font Configuration

## Status
Ready for Development

## Story
**As a** designer wanting modern, professional typography,
**I want** DM Sans and DM Mono fonts properly configured and loaded,
**so that** the application displays clean, readable typography that supports the minimal aesthetic.

## Acceptance Criteria

### Functional Requirements
1. **DM Sans Loaded**: DM Sans font family loaded from Google Fonts for headings and body text
2. **DM Mono Loaded**: DM Mono font family loaded from Google Fonts for code and monospace text
3. **Font Display Optimization**: Fonts use font-display: swap for optimal performance
4. **Typography Classes Updated**: Tailwind typography classes reference new font families

### Integration Requirements
5. Existing text content renders with new fonts without layout shifts
6. New fonts integrate seamlessly with Story 5.1 typography tokens
7. Font loading follows Next.js 15.5 font optimization best practices
8. Integration with existing layout.tsx structure maintained

### Quality Requirements
9. Font files loaded efficiently (< 100ms additional load time)
10. No layout shift (CLS) during font swap
11. Fonts render correctly across all browsers (Chrome, Firefox, Safari, Edge)
12. Fallback fonts provide acceptable rendering if Google Fonts unavailable

## Tasks / Subtasks

- [ ] **Task 1: Configure Google Fonts Import** (AC: 1, 2, 3)
  - [ ] Subtask 1.1: Add DM Sans import to layout.tsx using next/font/google
  - [ ] Subtask 1.2: Add DM Mono import to layout.tsx using next/font/google
  - [ ] Subtask 1.3: Configure font weights (DM Sans: 400, 600, 700)
  - [ ] Subtask 1.4: Configure display: 'swap' for both fonts

- [ ] **Task 2: Update Font Variable Configuration** (AC: 4, 6, 8)
  - [ ] Subtask 2.1: Replace Geist font variables with DM Sans/Mono
  - [ ] Subtask 2.2: Update className to apply new font variables
  - [ ] Subtask 2.3: Ensure CSS variables match Story 5.1 definitions
  - [ ] Subtask 2.4: Configure fallback font stack

- [ ] **Task 3: Tailwind Configuration Update** (AC: 4, 7)
  - [ ] Subtask 3.1: Verify Tailwind config references correct CSS variables
  - [ ] Subtask 3.2: Test font-sans and font-mono utility classes
  - [ ] Subtask 3.3: Validate typography plugin configuration (if used)

- [ ] **Task 4: Testing and Validation** (AC: 5, 9, 10, 11, 12)
  - [ ] Subtask 4.1: Test font loading performance (Lighthouse)
  - [ ] Subtask 4.2: Verify no CLS (Cumulative Layout Shift)
  - [ ] Subtask 4.3: Cross-browser rendering validation
  - [ ] Subtask 4.4: Test fallback fonts when Google Fonts blocked

## Dev Notes

### Previous Story Dependencies
**Requires Story 5.1 Completion**: Design system foundation must be implemented first to establish the typography CSS variables that this story implements.

### Previous Story Insights
From Story 5.1:
- CSS variables defined for --font-sans and --font-mono
- Typography scale and weights established
- Line height values configured
- Design tokens ready for font implementation

### Font Specifications

**DM Sans [Source: Original plan Section 1]:**
- **Purpose**: Primary font for headings and body text
- **Weights**: 400 (normal), 600 (semibold), 700 (bold)
- **Styles**: Normal (italic not needed for minimal aesthetic)
- **Source**: Google Fonts
- **Fallback**: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif

**DM Mono [Source: Original plan Section 1]:**
- **Purpose**: Code blocks, technical content, monospace needs
- **Weights**: 400 (normal)
- **Styles**: Normal
- **Source**: Google Fonts
- **Fallback**: 'Courier New', Courier, monospace

### Implementation Example

**Next.js Font Loading Pattern:**
```typescript
// apps/web/app/layout.tsx
import { DM_Sans, DM_Mono } from 'next/font/google';

const dmSans = DM_Sans({
  subsets: ['latin'],
  weight: ['400', '600', '700'],
  variable: '--font-sans',
  display: 'swap',
});

const dmMono = DM_Mono({
  subsets: ['latin'],
  weight: ['400'],
  variable: '--font-mono',
  display: 'swap',
});

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en" className={`${dmSans.variable} ${dmMono.variable}`}>
      <body className="font-sans">
        {children}
      </body>
    </html>
  );
}
```

### File Locations

**Files to Modify:**
- `/apps/web/app/layout.tsx` - Font loading and configuration

**Files to Reference (no changes):**
- `/apps/web/app/globals.css` - CSS variables defined in Story 5.1
- `/apps/web/tailwind.config.js` - Font family theme configuration

### Technical Implementation Details

**Font Loading Strategy [Source: Next.js 15.5 best practices]:**
1. Use Next.js font optimization (automatic subsetting and preloading)
2. Set display: 'swap' to prevent FOIT (Flash of Invisible Text)
3. Include only necessary weights to minimize file size
4. Define CSS variables for Tailwind integration

**Performance Optimization:**
- Next.js automatically preloads fonts in document head
- Font files cached by browser after first load
- Subsetting reduces font file size (Latin subset only)
- Display swap prevents render blocking

**Backward Compatibility:**
- Replace Geist font variables while maintaining same variable names
- Existing components reference --font-sans and --font-mono
- No component code changes required
- Fallback fonts ensure graceful degradation

### Performance Requirements

- **Font Load Time**: < 100ms additional load time (measured via Lighthouse)
- **CLS (Cumulative Layout Shift)**: 0 (font-display: swap prevents layout shift)
- **File Size**: DM Sans + DM Mono total < 200KB (with subsetting)
- **Preload**: Fonts automatically preloaded by Next.js optimization

### Testing Requirements

**Testing Standards [Source: architecture/testing-strategy.md]:**
- Performance testing (Lighthouse)
- Visual rendering validation
- Cross-browser compatibility
- Accessibility verification

**Specific Test Scenarios:**

1. **Font Loading Performance:**
   - Run Lighthouse audit before and after
   - Verify no regression in performance score
   - Check font files are preloaded correctly
   - Validate no render-blocking resources

2. **Visual Rendering:**
   - Verify DM Sans renders on headings (h1-h6)
   - Verify DM Sans renders on body text
   - Verify DM Mono renders on code blocks
   - Check font weight variations (400, 600, 700)

3. **Cross-Browser Testing:**
   - Chrome/Chromium (latest)
   - Firefox (latest)
   - Safari (latest)
   - Edge (latest)

4. **Fallback Testing:**
   - Block Google Fonts (browser DevTools)
   - Verify fallback fonts render acceptably
   - Check no console errors or warnings

### Technical Constraints

**Integration Requirements [Source: Epic 5 dependencies]:**
- Must use Next.js font optimization (not manual <link> tags)
- Must integrate with Story 5.1 CSS variables
- Must maintain existing layout.tsx structure and providers
- Must not increase bundle size significantly

**Scope Limitations:**
- Font loading only - no typography styling changes (Story 5.1)
- No component modifications in this story
- No page-specific font adjustments (Stories 5.3-5.7)
- Focus on font configuration and loading only

## Testing

### Testing Standards
- **Performance**: Google Lighthouse (target: 95+ performance score)
- **Visual**: Manual inspection across key pages
- **Cross-Browser**: BrowserStack or manual testing on major browsers
- **Accessibility**: Font rendering should not impact readability

### Specific Testing Requirements

1. **Performance Testing (Lighthouse):**
   - Run audit on landing page: `npm run build && npx serve out`
   - Verify no CLS (Cumulative Layout Shift) issues
   - Check font preloading is working
   - Validate performance score >= 95

2. **Visual Validation:**
   - Landing page typography renders with DM Sans
   - Dashboard headings display with correct font weights
   - Code blocks in workspace use DM Mono
   - Login/signup forms have clean typography

3. **Cross-Browser Compatibility:**
   - Chrome: Verify font rendering and weights
   - Firefox: Check font smoothing and anti-aliasing
   - Safari: Validate font weights (Safari can render weights differently)
   - Edge: Confirm no rendering issues

4. **Fallback Testing:**
   - Block fonts.googleapis.com in DevTools
   - Verify system fonts render acceptably
   - Check no JavaScript console errors
   - Validate layout remains intact

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-12-21 | 1.0 | Initial story creation for font configuration | John (Product Manager) |

## Dev Agent Record

*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results

*This section will be populated by the QA Agent upon story completion*
