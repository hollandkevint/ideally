# Story 2.3: "Business Model Problem" Revenue Analysis Pathway

## Status
Ready

## Story

**As a** user stuck on monetization and business model challenges,
**I want** systematic analysis of revenue streams, customer segments, and value propositions,
**so that** I can solve my specific business model problems with proven frameworks.

## Acceptance Criteria

1. **Revenue Stream Analysis**: Structured evaluation of current and potential revenue models with feasibility assessment
2. **Customer Segment Mapping**: AI-guided customer segmentation with value proposition alignment
3. **Business Model Validation**: Framework-based analysis using Lean Canvas or Business Model Canvas methodology
4. **Monetization Strategy**: Concrete recommendations for pricing models, revenue optimization, and growth strategies
5. **Implementation Roadmap**: Prioritized action plan with specific next steps for business model improvements

## Tasks / Subtasks

- [ ] Task 1: Implement Business Model Problem Pathway Template (AC: 1, 3)
  - [ ] Subtask 1.1: Create "Business Model Problem" pathway template with revenue analysis phases
  - [ ] Subtask 1.2: Design systematic questioning for revenue streams, pricing, and monetization
  - [ ] Subtask 1.3: Implement Business Model Canvas integration for framework-based analysis
  - [ ] Subtask 1.4: Add revenue feasibility assessment logic with market validation

- [ ] Task 2: Build Customer Segmentation and Value Prop Analysis (AC: 2)
  - [ ] Subtask 2.1: Create Claude prompts for customer segment identification
  - [ ] Subtask 2.2: Implement value proposition mapping to customer needs
  - [ ] Subtask 2.3: Add customer lifetime value (CLV) estimation logic
  - [ ] Subtask 2.4: Create customer acquisition cost (CAC) analysis framework

- [ ] Task 3: Develop Monetization Strategy Engine (AC: 4)
  - [ ] Subtask 3.1: Implement pricing model analysis (subscription, one-time, freemium, etc.)
  - [ ] Subtask 3.2: Create revenue optimization recommendation system
  - [ ] Subtask 3.3: Add competitive pricing analysis integration
  - [ ] Subtask 3.4: Build growth strategy recommendation engine

- [ ] Task 4: Create Implementation Roadmap Generator (AC: 5)
  - [ ] Subtask 4.1: Design prioritized action plan template
  - [ ] Subtask 4.2: Implement next steps recommendation based on business model gaps
  - [ ] Subtask 4.3: Add timeline estimation for business model improvements
  - [ ] Subtask 4.4: Create success metrics and KPI recommendations

- [ ] Task 5: Integration and Session Management (AC: 3, 5)
  - [ ] Subtask 5.1: Update BMad session orchestrator for Business Model pathway
  - [ ] Subtask 5.2: Implement pathway-specific progress tracking with business framework phases
  - [ ] Subtask 5.3: Add business model problem session state management
  - [ ] Subtask 5.4: Update database schema for business model analysis data

- [ ] Task 6: Testing and Validation (All ACs)
  - [ ] Subtask 6.1: Create unit tests for business model analysis logic
  - [ ] Subtask 6.2: Add integration tests for revenue stream analysis
  - [ ] Subtask 6.3: Implement E2E tests for complete Business Model session flow
  - [ ] Subtask 6.4: Add validation tests for Business Model Canvas generation

## Dev Notes

### Previous Story Dependencies
**Requires Story 2.1 & 2.2 Completion**:
- Pathway selection interface established (Story 2.1)
- Pathway template system and session management patterns available (Story 2.2)
- Database schema for pathway-specific data implemented

### Previous Story Insights
From Story 1.4 (AI Infrastructure):
- Claude Sonnet 4 integration with streaming and context management
- Session state management and persistence established

From Story 2.1 (Pathway Selection):
- Enhanced pathway selection and routing logic
- Pathway analytics and intent analysis capabilities

From Story 2.2 (New Idea Pathway):
- Pathway template system architecture
- Session orchestration patterns for structured coaching flows

### Data Models
**Business Model Pathway Schema** [Source: extending patterns from Story 2.2]
```sql
-- Extend bmad_sessions for Business Model pathway
ALTER TABLE bmad_sessions ADD COLUMN IF NOT EXISTS
  business_model_data jsonb DEFAULT '{}', -- Store business model analysis
  lean_canvas jsonb DEFAULT '{}'; -- Generated Lean Canvas

-- Business Model Problem specific phases
CREATE TABLE bmad_business_model_phases (
  id uuid default uuid_generate_v4() primary key,
  session_id uuid references bmad_sessions(id) on delete cascade,
  phase_name text check (phase_name in ('revenue_analysis', 'customer_segmentation', 'value_proposition', 'monetization_strategy', 'implementation_planning')),
  completed boolean default false,
  analysis_data jsonb default '{}',
  recommendations jsonb default '{}',
  time_spent interval,
  created_at timestamptz default now()
);
```

**Business Model Analysis Data Structure**:
```typescript
interface BusinessModelSession {
  currentModel: string;
  revenueStreams: RevenueStream[];
  customerSegments: CustomerSegment[];
  valuePropositions: ValueProposition[];
  pricingModels: PricingModel[];
  leanCanvas: LeanCanvasData;
  implementationRoadmap: ActionItem[];
  kpis: RecommendedMetric[];
}

interface RevenueStream {
  name: string;
  type: 'subscription' | 'one-time' | 'freemium' | 'marketplace' | 'advertising';
  feasibility: number;
  estimatedRevenue: string;
  implementation: string;
}
```

### API Specifications
**Business Model Pathway Endpoints** [Source: extending /api/bmad pattern]
- `POST /api/bmad` with `action: 'analyze_revenue_streams'` - Revenue analysis
- `POST /api/bmad` with `action: 'segment_customers'` - Customer segmentation analysis  
- `POST /api/bmad` with `action: 'generate_lean_canvas'` - Business Model Canvas creation
- `POST /api/bmad` with `action: 'create_implementation_roadmap'` - Action plan generation

**Claude Integration for Business Model Analysis**:
```typescript
const BUSINESS_MODEL_PROMPTS = {
  revenue_analysis: "Analyze the current revenue model and identify optimization opportunities...",
  customer_segmentation: "Help segment customers based on needs, behaviors, and value...",
  monetization_strategy: "Recommend pricing models and monetization strategies...",
  lean_canvas: "Generate a comprehensive Lean Canvas based on the analysis..."
};
```

### Component Specifications
**New Components Required**:
- `/apps/web/app/components/bmad/pathways/BusinessModelPathway.tsx` - Main business model pathway
- `/apps/web/app/components/bmad/pathways/RevenueAnalysis.tsx` - Revenue stream analysis interface
- `/apps/web/app/components/bmad/pathways/CustomerSegmentation.tsx` - Customer mapping interface
- `/apps/web/app/components/bmad/pathways/LeanCanvas.tsx` - Business Model Canvas display
- `/apps/web/app/components/bmad/pathways/ImplementationRoadmap.tsx` - Action plan interface

**Enhanced Components** [Source: following patterns from Story 2.2]:
- `/apps/web/app/components/bmad/BmadInterface.tsx` - Add Business Model pathway integration
- `/apps/web/app/components/bmad/SessionManager.tsx` - Add business model phase tracking

### File Locations
**New Files to Create**:
- `/apps/web/lib/bmad/pathways/business-model-pathway.ts` - Business model analysis logic
- `/apps/web/lib/bmad/frameworks/lean-canvas.ts` - Lean Canvas generation
- `/apps/web/lib/bmad/analysis/revenue-stream-analyzer.ts` - Revenue analysis engine
- `/apps/web/lib/bmad/templates/business-model-templates.ts` - Business model questions and frameworks

**Files to Modify**:
- `/apps/web/app/api/bmad/route.ts` - Add business model pathway actions
- `/apps/web/lib/bmad/session-orchestrator.ts` - Business model pathway integration
- `/apps/web/lib/bmad/types.ts` - Add business model pathway types

### Technical Implementation Details
**Business Model Pathway Flow** [Source: Epic 2 requirements]:
1. **Revenue Analysis Phase (10 minutes)**: Current model evaluation, revenue stream identification, feasibility assessment
2. **Customer Segmentation Phase (8 minutes)**: Target market analysis, customer persona development, needs mapping
3. **Value Proposition Phase (6 minutes)**: Value prop alignment, competitive differentiation analysis
4. **Monetization Strategy Phase (4 minutes)**: Pricing recommendations, revenue optimization strategies
5. **Implementation Planning Phase (2 minutes)**: Roadmap generation, next steps, success metrics

**Business Framework Integration**:
- Lean Canvas methodology implementation
- Business Model Canvas components
- Value Proposition Canvas integration
- Customer Development principles

### Integration with Business Frameworks
**Lean Canvas Components** [Source: standard business methodology]:
- Problem identification and validation
- Solution mapping and features
- Unique value proposition development
- Customer segments and early adopters
- Revenue streams and cost structure
- Key metrics and unfair advantage analysis

### Performance Requirements
**Analysis Performance Standards** [Source: Epic 2 acceptance criteria]:
- Revenue stream analysis: <15 seconds
- Customer segmentation: <10 seconds
- Lean Canvas generation: <8 seconds
- Implementation roadmap: <5 seconds
- Total session duration: 30 minutes maximum

### Testing Requirements
**Testing Standards** [Source: established patterns from previous stories]
- Unit tests: `/apps/web/tests/components/bmad/pathways/business-model/`
- Integration tests: `/apps/web/tests/integration/business-model-pathway.test.ts`
- E2E tests: `/apps/web/tests/e2e/business-model-session-flow.test.ts`

**Specific Test Scenarios**:
- Complete business model analysis session
- Revenue stream feasibility calculations
- Customer segmentation accuracy validation
- Lean Canvas generation with various business models
- Implementation roadmap prioritization logic
- Error handling for incomplete business information

### Business Framework Validation
**Methodology Compliance**:
- Ensure Lean Canvas follows standard methodology
- Validate Business Model Canvas component relationships
- Test value proposition-customer segment alignment
- Verify revenue stream feasibility calculations

### Previous Story Insights
From Story 2.2 (New Idea Creative Expansion Pathway) - **COMPLETED**:
- Established pathway template system architecture with 30-minute structured sessions
- Created comprehensive session orchestration patterns with real-time time management
- Implemented AI analysis engine with Claude integration (MarketPositioningAnalyzer)
- Built document generation system with multiple output formats (ConceptDocumentGenerator)
- Enhanced session orchestrator with pathway-specific processing
- Added API endpoints pattern: `/api/bmad` with action-based routing
- Created comprehensive testing patterns: unit, integration, and e2e tests

**Key Technical Files Available for Reuse**:
- `/apps/web/lib/bmad/session-orchestrator.ts` - Enhanced with pathway integration patterns
- `/apps/web/lib/bmad/types.ts` - Updated with pathway type definitions
- `/apps/web/app/api/bmad/route.ts` - API routing patterns established
- Template system architecture established in `/apps/web/lib/bmad/templates/`

### Data Models
**Based on Story 2.2 Patterns** [Source: apps/web/lib/bmad/types.ts]:
Business Model pathway will extend existing session management with:
```typescript
// Following established NewIdeaPhaseData pattern
interface BusinessModelPhaseData {
  currentModel?: string;
  revenueStreams: RevenueStream[];
  customerSegments: CustomerSegment[];
  valuePropositions: ValueProposition[];
  leanCanvasData?: LeanCanvasData;
}

interface RevenueStream {
  id: string;
  name: string;
  type: 'subscription' | 'one-time' | 'freemium' | 'marketplace' | 'advertising';
  feasibility: number;
  estimatedRevenue: string;
  implementation: string;
  confidence: number;
}
```

**Database Schema** [Source: following Story 2.2 patterns]:
- Extend existing `bmad_sessions` table with `business_model_data jsonb DEFAULT '{}'`
- Follow established pathway phase table pattern from Story 2.2
- Use existing session orchestrator integration points

### API Specifications
**Following Story 2.2 API Pattern** [Source: app/api/bmad/route.ts]:
Business Model pathway will add actions to existing `/api/bmad` endpoint:
- `analyze_revenue_streams` - Revenue stream analysis 
- `segment_customers` - Customer segmentation analysis
- `generate_lean_canvas` - Business Model Canvas creation
- `create_implementation_roadmap` - Action plan generation

**Claude Integration** [Source: Story 2.2 MarketPositioningAnalyzer pattern]:
Follow established analyzer pattern with phase-specific prompts:
```typescript
const BUSINESS_MODEL_PROMPTS = {
  revenue_analysis: "You are a business model strategist...",
  customer_segmentation: "You are a customer development expert...",
  monetization_strategy: "You are a pricing and monetization specialist...",
  lean_canvas: "You are a Lean Startup methodology expert..."
};
```

### Component Specifications
**Following Story 2.2 Architecture** [Source: pathway orchestration patterns]:
- Create `BusinessModelPathway` class following `NewIdeaPathway` pattern
- Implement `RevenueStreamAnalyzer` following `MarketPositioningAnalyzer` pattern  
- Create `LeanCanvasGenerator` following `ConceptDocumentGenerator` pattern
- Follow established factory function pattern for component creation

### File Locations
**Based on Story 2.2 File Structure** [Source: established pathway organization]:
```
/apps/web/lib/bmad/pathways/business-model-pathway.ts (main orchestrator)
/apps/web/lib/bmad/analysis/revenue-stream-analyzer.ts (AI analysis)
/apps/web/lib/bmad/frameworks/lean-canvas-generator.ts (document generation)
/apps/web/lib/bmad/templates/business-model-templates.ts (templates)
/apps/web/__tests__/bmad/pathways/business-model-pathway.test.ts (tests)
/apps/web/__tests__/integration/business-model-pathway-integration.test.ts (integration)
```

### Technical Implementation Details
**Business Model Pathway Flow** [Source: Epic 2 requirements + Story 2.2 patterns]:
1. **Revenue Analysis Phase (10 minutes)**: Current model evaluation, revenue stream identification
2. **Customer Segmentation Phase (8 minutes)**: Target market analysis, persona development  
3. **Value Proposition Phase (6 minutes)**: Value prop alignment, competitive differentiation
4. **Monetization Strategy Phase (4 minutes)**: Pricing recommendations, optimization strategies
5. **Implementation Planning Phase (2 minutes)**: Roadmap generation, success metrics

**Integration with Story 2.2 Infrastructure**:
- Reuse session orchestrator enhancements
- Follow established AI analysis patterns  
- Use existing API endpoint structure
- Leverage document generation architecture
- Follow time management and phase transition logic

### Performance Requirements
**Established Standards from Story 2.2**:
- Phase transitions: <2 seconds
- AI analysis calls: <10-15 seconds  
- Document generation: <5-8 seconds
- Total session duration: 30 minutes maximum
- All technical patterns proven in Story 2.2 implementation

### Security and Integration
**Following Story 2.2 Patterns**:
- Supabase RLS patterns maintained
- Secure API communication established
- User data isolation through existing session management
- TypeScript strict typing throughout
- Error handling and fallback mechanisms

## Testing

### Testing Standards
- **Test Location**: `/apps/web/tests/components/bmad/pathways/business-model/`
- **Integration Tests**: `/apps/web/tests/integration/`
- **E2E Tests**: `/apps/web/tests/e2e/` with Playwright
- **Business Framework Testing**: Validate generated frameworks against established methodologies
- **Coverage**: Minimum 80% code coverage for business model analysis logic

### Specific Testing Requirements
- Business model pathway component interaction testing
- Revenue analysis calculation accuracy with various business models
- Customer segmentation algorithm validation
- Lean Canvas generation completeness and accuracy
- Implementation roadmap prioritization logic testing
- Performance testing for business framework analysis within SLA

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-14 | 1.0 | Initial story creation for Epic 2 Business Model pathway | Bob (Scrum Master) |

## Dev Agent Record

*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results

*This section will be populated by the QA agent upon story completion*