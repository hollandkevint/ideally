# Story 6.5: 10-Message Trial Gate

**Status:** Ready
**Priority:** P1 - High
**Estimate:** 2-3 hours
**Depends On:** Story 6.4

## User Story

As a guest user, I want to experience 10 messages of value before being asked to sign up, so that I understand what ThinkHaven offers before committing.

## Context

Current trial allows 5 messages. Strategic direction specifies 10 messages with partial output at gate:

> "10 messages (up from current 5). Partial output provided at gate (value first). Full output + save + export requires signup."

The goal: give enough value that users feel they've started something worth continuing.

## Acceptance Criteria

1. **Guest flow allows 10 messages**
   - Counter shows "3 of 10 messages"
   - Natural pacing for meaningful conversation
   - Enough to demonstrate pushback and structure

2. **Partial output at gate**
   - Show preview of Lean Canvas (3-4 sections populated)
   - Show outline of PRD (headers only)
   - Viability score teaser: "Your idea scored ___/10"

3. **Gate appears after message 10**
   - Modal with clear value proposition
   - Shows what user has built so far
   - Call to action: "Save your work"

4. **Session preservation**
   - Guest session stored in localStorage
   - Migrates to account on signup
   - No loss of conversation history

5. **Friction-appropriate gate**
   - Can dismiss and continue (2 more messages)
   - Hard gate at message 12
   - Email capture option for later

## Technical Implementation

### Files to Modify

1. **`lib/guest/session-store.ts`**
   - Update `MAX_GUEST_MESSAGES` from 5 to 10
   - Add soft gate at 10, hard gate at 12

2. **`app/components/guest/SignupPromptModal.tsx`**
   - Add partial output preview
   - Include viability score teaser
   - Improve copy and design

3. **`app/components/guest/GuestChatInterface.tsx`**
   - Update message counter display
   - Show progress toward gate

4. **`lib/guest/session-migration.ts`**
   - Verify migration handles 10+ messages
   - Include partial output in migration

5. **`app/api/chat/guest/route.ts`**
   - Enforce message limit
   - Return partial output data at gate

### Message Limit Logic

```typescript
const TRIAL_CONFIG = {
  softGate: 10,    // Show modal, allow dismiss
  hardGate: 12,    // Must signup to continue
  partialOutputAt: 10
};

function checkTrialLimit(messageCount: number): TrialStatus {
  if (messageCount < TRIAL_CONFIG.softGate) {
    return { status: 'active', remaining: TRIAL_CONFIG.softGate - messageCount };
  }
  if (messageCount < TRIAL_CONFIG.hardGate) {
    return { status: 'soft_gate', remaining: TRIAL_CONFIG.hardGate - messageCount };
  }
  return { status: 'hard_gate', remaining: 0 };
}
```

### Partial Output Preview

```typescript
interface PartialOutput {
  leanCanvasPreview: {
    problem: string | null;
    solution: string | null;
    uvp: string | null;
    // Rest shown as "Sign up to see more..."
  };
  prdOutline: string[]; // Just headers
  viabilityTeaser: {
    score: number;
    topIssue: string;
    message: string; // "Your idea shows promise in X but needs work on Y"
  };
}

function generatePartialOutput(messages: Message[]): PartialOutput {
  // Extract just enough to show value
  // Leave the best content for post-signup
}
```

### Gate Modal Content

```tsx
function TrialGateModal({ partialOutput, onSignup, onDismiss }) {
  return (
    <Modal>
      <h2>Your session is just getting started</h2>

      <div className="viability-teaser">
        <span className="score">{partialOutput.viabilityTeaser.score}/10</span>
        <p>{partialOutput.viabilityTeaser.message}</p>
      </div>

      <div className="preview">
        <h3>What you've built so far:</h3>
        <LeanCanvasPreview data={partialOutput.leanCanvasPreview} />
        <p className="more">Sign up to see full analysis and export</p>
      </div>

      <div className="actions">
        <Button primary onClick={onSignup}>
          Save My Work
        </Button>
        <Button secondary onClick={onDismiss}>
          2 more messages
        </Button>
      </div>

      <p className="reassurance">
        Your conversation is saved locally. Sign up to keep it forever.
      </p>
    </Modal>
  );
}
```

## Testing

### Unit Tests
- [ ] Message limit enforcement
- [ ] Partial output generation
- [ ] Session migration with 10+ messages

### Integration Tests
- [ ] Full guest flow to soft gate
- [ ] Dismiss and continue to hard gate
- [ ] Signup preserves full conversation

### Manual Testing
- [ ] Counter displays correctly
- [ ] Gate appears at right moment
- [ ] Partial output compelling
- [ ] Migration seamless

## Dependencies

- Story 6.4 (Output generation for preview)
- Existing guest session infrastructure

## Out of Scope

- A/B testing different limits
- Analytics on trial conversion
- Alternative gate treatments

## Notes

The trial experience should feel generous, not stingy. 10 messages is enough to:
- Describe an idea
- Receive 3-4 probing questions
- Experience some pushback
- Start to feel the methodology

The partial output at gate creates FOMO without being manipulative - users can see they've actually created something valuable.
